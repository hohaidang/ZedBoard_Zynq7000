/* Project nay dung UART de send len putty hoac terminal vitis thong qua cong
   USB cam vao board va control LED thong qua bo Axi GPIO duoc tao ra trong
   vivado
  */
#include "xil_printf.h"
#include "xparameters.h"
#include "xuartps.h"
#include "xgpiops.h"
#include "xstatus.h"
#include <array>

#define UART_DEVICE_ID XPAR_XUARTPS_0_DEVICE_ID
#define LED_CHANNEL 1
#define LED_DELAY 10000000
 #define PIN_OFFSET 54 // [0:53] is MIO pins, so EMIO from 54

XUartPs Uart_PS;
XGpioPs Gpio;
XGpioPs_Config *ConfigPtr;
int Status;

void gpio_control() {
  ConfigPtr = XGpioPs_LookupConfig(XPAR_XGPIOPS_0_DEVICE_ID);
  Status = XGpioPs_CfgInitialize(&Gpio, ConfigPtr, ConfigPtr->BaseAddr);
  if(Status != XST_SUCCESS) {
    xil_printf("GPIO Initialize failed");
    return;
  }
  XGpioPs_SetDirectionPin(&Gpio, PIN_OFFSET, 1);
  XGpioPs_SetOutputEnablePin(&Gpio, PIN_OFFSET, 1);
  XGpioPs_WritePin(&Gpio, PIN_OFFSET, 1);
}

int main(void) {
  uart_control();
  gpio_control();
  return 0;
}
